<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --neon-green: #00F5C4;
            --dark-bg: #081015;
            --card-bg: rgba(255, 255, 255, 0.05);
            --danger: #ff4d4d;
            --edit: #ffa502;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            background: var(--dark-bg);
            color: white;
            font-family: 'Cairo', sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        /* Ø®Ù„ÙÙŠØ© Ø´Ø¨ÙƒÙŠØ© Ø®ÙÙŠÙØ© */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(rgba(0, 245, 196, 0.1) 1px, transparent 1px);
            background-size: 30px 30px; z-index: -1; opacity: 0.3;
        }

        h1 {
            color: var(--neon-green);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 245, 196, 0.4);
        }

        .header-section {
            width: 100%; max-width: 900px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px;
        }

        /* Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø­Ø±ÙŠ */
        .add-btn {
            background: var(--neon-green);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex; align-items: center; gap: 10px;
            box-shadow: 0 0 15px rgba(0, 245, 196, 0.3);
            transition: 0.3s;
        }
        .add-btn:hover { transform: translateY(-3px); box-shadow: 0 0 30px rgba(0, 245, 196, 0.6); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØ±ÙˆØª */
        .grid {
            width: 100%; max-width: 900px;
            display: grid; grid-template-columns: 1fr; gap: 20px;
        }

        .notif-card {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-right: 5px solid var(--neon-green);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.3s;
            position: relative; overflow: hidden;
        }

        .notif-card:hover { transform: scale(1.02); background: rgba(255,255,255,0.08); }

        .notif-info h3 { margin: 0 0 10px 0; font-size: 1.3rem; color: #fff; }
        .notif-info p { margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem; max-width: 600px; }
        
        .meta-data {
            display: flex; gap: 20px; font-size: 0.85rem; color: var(--neon-green); font-weight: bold;
        }
        .meta-data span { display: flex; align-items: center; gap: 5px; }

        .actions { display: flex; gap: 10px; }
        
        .btn-action {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-size: 1.1rem; transition: 0.3s; color: white;
        }
        .btn-edit { background: rgba(255, 165, 2, 0.2); color: var(--edit); border: 1px solid var(--edit); }
        .btn-edit:hover { background: var(--edit); color: #000; }
        
        .btn-delete { background: rgba(255, 77, 77, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .btn-delete:hover { background: var(--danger); color: white; }

        /* Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ (Modal) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; z-index: 9999;
        }
        
        .modal-box {
            background: #0d1b24;
            border: 2px solid var(--neon-green);
            width: 90%; max-width: 500px;
            padding: 30px; border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 245, 196, 0.2);
            text-align: center;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popIn { from {transform: scale(0.5); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        .modal-box h2 { color: var(--neon-green); margin-top: 0; }
        
        input, textarea {
            width: 100%; padding: 15px; margin-bottom: 15px;
            background: rgba(255,255,255,0.05); border: 1px solid #333;
            color: white; border-radius: 10px; font-family: 'Cairo'; font-size: 1rem;
        }
        input:focus, textarea:focus { border-color: var(--neon-green); }

        .modal-btns { display: flex; gap: 10px; }
        .btn-save { flex: 2; background: var(--neon-green); border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-cancel { flex: 1; background: #333; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; }

    </style>
</head>
<body>

    <div class="header-section">
        <div>
            <h1>ØºØ±ÙØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© âš¡</h1>
            <p style="opacity: 0.7;">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</p>
        </div>
        <button class="add-btn" onclick="openAddModal()">
            <i class="fas fa-plus-circle"></i> ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯
        </button>
    </div>

    <div class="grid" id="notificationsGrid">
        <p style="text-align:center; opacity:0.5;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-box">
            <h2 id="modalTitle">ğŸ”” ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯</h2>
            <input type="hidden" id="editId">
            <input type="text" id="notifTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ù…Ø«Ù„Ø§Ù‹: Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹)">
            <textarea id="notifContent" rows="4" placeholder="Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡..."></textarea>
            
            <div class="modal-btns">
                <button class="btn-save" onclick="saveNotification()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù† ğŸš€</button>
                <button class="btn-cancel" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”¥ğŸ”¥ ØºÙŠØ±ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¯Ù‡ Ù„Ø±Ø§Ø¨Ø· Ø³ÙŠØ±ÙØ±Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ğŸ”¥ğŸ”¥
        const API_URL = "https://notice-full.vercel.app";

        let allNotifications = [];

        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function loadNotifications() {
            const grid = document.getElementById('notificationsGrid');
            try {
                // Ø¨Ù†Ø·Ù„Ø¨ Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ù…Ù† Ø¹Ø´Ø§Ù† Ù†Ø´ÙˆÙ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
                const res = await fetch(`${API_URL}/admin/all-notifications`);
                const data = await res.json();
                
                allNotifications = data.reverse(); // Ø§Ù„Ø£Ø­Ø¯Ø« ÙÙˆÙ‚

                grid.innerHTML = '';
                if(data.length === 0) {
                    grid.innerHTML = '<p style="text-align:center;">Ù…ÙÙŠØ´ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸ¤·â€â™‚ï¸</p>';
                    return;
                }

                allNotifications.forEach(note => {
                    const card = document.createElement('div');
                    card.className = 'notif-card';
                    card.innerHTML = `
                        <div class="notif-info">
                            <h3>${note.title}</h3>
                            <p>${note.content}</p>
                            <div class="meta-data">
                                <span><i class="far fa-clock"></i> ${note.date}</span>
                                <span><i class="far fa-eye"></i> ${note.views || 0} Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                            </div>
                        </div>
                        <div class="actions">
                            <button class="btn-action btn-edit" onclick="openEditModal('${note.id}')">
                                <i class="fas fa-pen"></i>
                            </button>
                            <button class="btn-action btn-delete" onclick="deleteNotification('${note.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    grid.appendChild(card);
                });

            } catch (err) {
                console.error(err);
                grid.innerHTML = '<p style="color:red; text-align:center;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±!</p>';
            }
        }

        // 2. ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ù„Ø¥Ø¶Ø§ÙØ©
        function openAddModal() {
            document.getElementById('modalTitle').innerText = 'ğŸ”” ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('editId').value = '';
            document.getElementById('notifTitle').value = '';
            document.getElementById('notifContent').value = '';
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        // 3. ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        function openEditModal(id) {
            const note = allNotifications.find(n => n.id === id);
            if(note) {
                document.getElementById('modalTitle').innerText = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡';
                document.getElementById('editId').value = id;
                document.getElementById('notifTitle').value = note.title;
                document.getElementById('notifContent').value = note.content;
                document.getElementById('modalOverlay').style.display = 'flex';
            }
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        // 4. Ø­ÙØ¸ (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„)
        async function saveNotification() {
            const id = document.getElementById('editId').value;
            const title = document.getElementById('notifTitle').value;
            const content = document.getElementById('notifContent').value;
            const btn = document.querySelector('.btn-save');

            if(!title || !content) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„!");

            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
            btn.disabled = true;

            const payload = { title, content };

            try {
                if(id) {
                    // ØªØ¹Ø¯ÙŠÙ„ (PUT)
                    await fetch(`${API_URL}/update-notification/${id}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(payload)
                    });
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯ (POST)
                    await fetch(`${API_URL}/add-notification`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(payload)
                    });
                }
                
                closeModal();
                loadNotifications(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

            } catch (err) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£!");
                console.error(err);
            }
            btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ø¢Ù† ğŸš€";
            btn.disabled = false;
        }

        // 5. Ø­Ø°Ù
        async function deleteNotification(id) {
            if(!confirm("Ø£ÙƒÙŠØ¯ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¯Ù‡ØŸ Ø§Ù„Ù†Ø§Ø³ Ù…Ø´ Ù‡ØªØ´ÙˆÙÙ‡ ØªØ§Ù†ÙŠ.")) return;

            try {
                await fetch(`${API_URL}/delete-notification/${id}`, { method: 'DELETE' });
                loadNotifications();
            } catch (err) {
                alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù");
            }
        }

        // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        loadNotifications();

    </script>
</body>
</html>
